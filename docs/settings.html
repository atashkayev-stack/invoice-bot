<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profileinstellungen</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 15px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .form-control, .form-select {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #000000);
            border: 1px solid var(--tg-theme-hint-color, #999999);
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 10px;
        }
        .form-label {
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-color, #0088cc);
        }
        .btn-primary {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-weight: 600;
            width: 100%;
            margin-top: 15px;
        }
        .form-check-input {
            margin-top: 0.25rem;
        }
        .info-text {
            font-size: 12px;
            color: var(--tg-theme-hint-color, #999999);
            margin-top: -8px;
            margin-bottom: 10px;
        }
        .required::after {
            content: " *";
            color: #ff3b30;
        }
    </style>
</head>
<body>
    <div class="container">
        <h4 style="margin-bottom: 20px;">‚öôÔ∏è Profileinstellungen</h4>
        
        <form id="settingsForm">
            <!-- Grunddaten -->
            <div class="section-title">üè¢ Firmendaten</div>
            
            <div class="mb-3">
                <label class="form-label required">Firma / Name</label>
                <input type="text" class="form-control" id="company_name" 
                       placeholder="z.B. Max Mustermann IT-Consulting" required>
                <div class="info-text">Name wie er auf Rechnungen erscheinen soll</div>
            </div>
            
            <div class="mb-3">
                <label class="form-label required">Vollst√§ndige Adresse</label>
                <input type="text" class="form-control" id="address" 
                       placeholder="Musterstra√üe 123, 10115 Berlin" required>
            </div>
            
            <div class="mb-3">
                <label class="form-label">E-Mail</label>
                <input type="email" class="form-control" id="email" 
                       placeholder="kontakt@firma.de">
            </div>
            
            <div class="mb-3">
                <label class="form-label">Telefon</label>
                <input type="tel" class="form-control" id="phone" 
                       placeholder="+49 30 12345678">
            </div>
            
            <!-- Steuerdaten -->
            <div class="section-title">üî¢ Steuerdaten</div>
            
            <div class="mb-3">
                <label class="form-label">Steuernummer</label>
                <input type="text" class="form-control" id="tax_id" 
                       placeholder="123/456/78901">
                <div class="info-text">Deine pers√∂nliche Steuernummer vom Finanzamt</div>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Umsatzsteuer-ID (USt-IdNr.)</label>
                <input type="text" class="form-control" id="vat_id" 
                       placeholder="DE123456789">
                <div class="info-text">Nur f√ºr umsatzsteuerpflichtige Unternehmen</div>
            </div>
            
            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="is_kleinunternehmer">
                    <label class="form-check-label" for="is_kleinunternehmer">
                        Kleinunternehmer gem√§√ü ¬ß19 UStG
                    </label>
                </div>
                <div class="info-text">Wenn aktiviert: Keine Umsatzsteuer auf Rechnungen</div>
            </div>
            
            <!-- Bankdaten -->
            <div class="section-title">üè¶ Bankverbindung</div>
            
            <div class="mb-3">
                <label class="form-label">Bank</label>
                <input type="text" class="form-control" id="bank_name" 
                       placeholder="Sparkasse Berlin">
            </div>
            
            <div class="mb-3">
                <label class="form-label">IBAN</label>
                <input type="text" class="form-control" id="iban" 
                       placeholder="DE89 3704 0044 0532 0130 00"
                       pattern="[A-Z]{2}[0-9]{2}[A-Z0-9]+"
                       title="G√ºltige IBAN eingeben">
                <div class="info-text">Internationale Bankkontonummer</div>
            </div>
            
            <div class="mb-3">
                <label class="form-label">BIC / SWIFT</label>
                <input type="text" class="form-control" id="bic" 
                       placeholder="COBADEFFXXX">
            </div>
            
            <!-- Weitere Angaben -->
            <div class="section-title">üìã Weitere Angaben (optional)</div>
            
            <div class="mb-3">
                <label class="form-label">Handelsregisternummer</label>
                <input type="text" class="form-control" id="registration_number" 
                       placeholder="HRB 12345 B">
            </div>
            
            <div class="mb-3">
                <label class="form-label">Gesch√§ftsf√ºhrer</label>
                <input type="text" class="form-control" id="ceo_name" 
                       placeholder="Max Mustermann">
            </div>
            
            <div class="mb-3">
                <label class="form-label">Zahlungsziel (Tage)</label>
                <input type="number" class="form-control" id="payment_terms" 
                       value="14" min="1" max="90">
                <div class="info-text">Standard-Zahlungsfrist f√ºr Rechnungen</div>
            </div>
            
            <button type="submit" class="btn btn-primary">
                üíæ Profil speichern
            </button>
        </form>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.hide();

        // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
        document.getElementById('settingsForm').onsubmit = (e) => {
            e.preventDefault();
            
            const data = {
                company_name: document.getElementById('company_name').value,
                address: document.getElementById('address').value,
                email: document.getElementById('email').value || null,
                phone: document.getElementById('phone').value || null,
                tax_id: document.getElementById('tax_id').value || null,
                vat_id: document.getElementById('vat_id').value || null,
                is_kleinunternehmer: document.getElementById('is_kleinunternehmer').checked,
                bank_name: document.getElementById('bank_name').value || null,
                iban: document.getElementById('iban').value || null,
                bic: document.getElementById('bic').value || null,
                registration_number: document.getElementById('registration_number').value || null,
                ceo_name: document.getElementById('ceo_name').value || null,
                payment_terms: parseInt(document.getElementById('payment_terms').value) || 14
            };
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω–æ –≤ –±–æ—Ç
            tg.sendData(JSON.stringify(data));
        };

        // –ê–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ IBAN
        document.getElementById('iban').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s/g, '').toUpperCase();
            let formatted = value.match(/.{1,4}/g)?.join(' ') || value;
            e.target.value = formatted;
        });
    </script>
</body>
</html>
